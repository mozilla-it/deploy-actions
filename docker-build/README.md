<!-- Generated by https://github.com/reakaleek/gh-action-readme -->
# <!--name-->docker-build<!--/name-->

<!--description-->
This GitHub Action is designed to build a Docker container image, providing
standard MozCloud tags for supported registries. It loads the built image
into the local Docker context, making it available for immediate use in
subsequent workflow steps (e.g., in docker compose files).

The action outputs a list of registry images in image_tags to be consumed by
the docker-push action. In addition to the GAR and optionally GHCR image,
the action also tags the built image with the plain `image_name` input for
local use only. This local tag is not included in the action's outputs and
will not be pushed to any registry.
<!--/description-->

## Inputs

<!--inputs-->
| Name                  | Description                              | Required | Default        |
|-----------------------|------------------------------------------|----------|----------------|
| `image_name`          | Name to give to the built image          | `true`   | ` `            |
| `gar_location`        | GCP region where GAR is located          | `false`  | `us`           |
| `gar_name`            | Name of the GAR repository               | `true`   | ` `            |
| `project_id`          | GCP project ID                           | `true`   | ` `            |
| `docker_build_args`   | Build-time variables                     | `false`  | ` `            |
| `image_build_context` | Path to the Docker build context         | `false`  | `./`           |
| `dockerfile_path`     | Path to the Dockerfile                   | `false`  | `./Dockerfile` |
| `image_tag_metadata`  | Metadata to append to image tag          | `false`  | ` `            |
| `should_tag_ghcr`     | Tag images for GitHub Container Registry | `false`  | `false`        |
| `should_tag_latest`   | Tag images as latest                     | `false`  | `false`        |
<!--/inputs-->

### Input Details

#### `gar_name` and `project_id`

These inputs follow MozCloud conventions:
- `gar_name`: Typically `<tenant name>-prod` (e.g., `my-team-prod`)
- `project_id`: Typically `moz-fx-<tenant name>-prod` (e.g., `moz-fx-my-team-prod`)

#### `docker_build_args`

Optional list of build-time variables passed to the Docker build process. See the [Docker documentation](https://docs.docker.com/engine/reference/commandline/buildx_build/#build-arg) for more details.

#### `image_build_context` and `dockerfile_path`

Both of these paths are relative to the repository root. The default values (`./` and `./Dockerfile`) assume your Dockerfile is at the root of your repository.

#### `image_tag_metadata`

Optional metadata to append to the image tag. For example, for a workflow triggered by a git tag `v1.2.3` and an `image_tag_metadata` value of `dev`, the final image tag will be `v1.2.3--dev`.


## Outputs

<!--outputs-->
| Name         | Description                                             |
|--------------|---------------------------------------------------------|
| `image_tags` | A newline-delimited list of generated Docker image tags |
<!--/outputs-->

## Example

### Usage

This example demonstrates how to build a Docker container image for a service named `my-service`. The image is:

- Tagged with metadata indicating the target deployment environment (e.g., `dev`, `stage`, `prod`).
- Tagged so that it can be published to both Google Artifact Registry and GitHub Container Registry.

```yaml
- uses: mozilla-it/deploy-actions/docker-build@v4
  with:
    image_name: my-service
    gar_name: tenant-prod
    project_id: moz-fx-tenant-prod
    image_tag_metadata: ${{ steps.preflight.outputs.deployment-env }} # resolves to `dev` for the purposes of this example
    should_tag_ghcr: true
```

### Outputs

Assumes image was built in the repo `mozilla/my-repo`, triggered by pushing a tag `v1.0.0`

#### `image_tags`

```
ghcr.io/mozilla/my-repo/my-service:v1.0.0--dev
us-docker.pkg.dev/moz-fx-tenant-prod/tenant-prod/my-service:v1.0.0--dev
```
