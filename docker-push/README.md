# Docker Push to GAR Composite Action

This GitHub Action is designed to push Docker images to Google Artifact Registry (GAR). It can optionally authenticate to GitHub Container Registry (GHCR) and create GitHub Deployments for specified environments.

## Inputs

| Name                                    | Required | Description                                                                                                                                 |
| --------------------------------------- | -------- | ------------------------------------------------------------------------------------------------------------------------------------------- |
| `gar_location`                          | Yes      | GCP region where the target GAR is located (default: `us`)                                                                                  |
| `should_authenticate_to_ghcr`           | No       | Whether or not to authenticate to GitHub Container Registry (default: `false`)                                                              |
| `image_tags`                            | Yes      | Newline-delimited list of images to be pushed.<br> Typically generated by `mozilla/deploy-actions/build-image` or `docker/metadata-action`. |
| `workload_identity_pool_project_number` | Yes      | Project number of the workload identity pool used for OIDC authentication                                                                   |
| `project_id`                            | Yes      | GCP `project_id` used to construct the service account                                                                                      |
| `deployment_env`                        | No       | If set, creates a GitHub deployment in the given environment                                                                                |

## Example Usage

```yaml
jobs:
  push-image:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event_name == 'pull_request' && github.event.pull_request.head.sha || github.ref }}
      - name: Build Docker image
        id: build
        run: ...
      - name: Push Docker image to GAR
        uses: mozilla-it/deploy-actions/docker-push@v4
        with:
          gar_location: us-central1
          # typically provided from another step's output ${{ steps.build.outputs.image_tags }}
          image_tags: |
            us-docker.pkg.dev/moz-fx-tenant-realm/tenant-realm/my-image:latest
            us-docker.pkg.dev/moz-fx-tenant-realm/tenant-realm/my-image:v1.0.0
          project_id: moz-fx-tenant-realm
          workload_identity_pool_project_number: ${{ vars.GCPV2_WORKLOAD_IDENTITY_POOL_PROJECT_NUMBER }}
```
