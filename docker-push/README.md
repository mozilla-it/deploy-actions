# Docker Push to GAR Composite Action

This GitHub Action is designed to push Docker images to Google Artifact Registry (GAR). It can optionally authenticate to GitHub Container Registry (GHCR) and create GitHub Deployments for specified environments.

## Inputs

| Name                                    | Required | Description                                                                                                                                 |
| --------------------------------------- | -------- | ------------------------------------------------------------------------------------------------------------------------------------------- |
| `gar_location`                          | Yes      | GCP region where the target GAR is located (default: `us`)                                                                                  |
| `should_authenticate_to_ghcr`           | No       | Whether or not to authenticate to GitHub Container Registry (default: `false`)                                                              |
| `image_tags`                            | Yes      | Newline-delimited list of images to be pushed.<br> Typically generated by `mozilla/deploy-actions/build-image` or `docker/metadata-action`. |
| `workload_identity_pool_project_number` | Yes      | Project number of the workload identity pool used for OIDC authentication                                                                   |
| `project_id`                            | Yes      | GCP `project_id` used to construct the service account                                                                                      |
| `deployment_env`                        | No       | If set, creates a GitHub deployment in the given environment                                                                                |

## Example Usage

```yaml
- name: Push Docker image to GAR and GHCR
  uses: mozilla-it/deploy-actions/docker-push@v4
  with:
    gar_location: us
    # typically provided from another step's output
    image_tags: |
      ghcr.io/mozilla/my-repo/my-image:v1.0.0
      us-docker.pkg.dev/moz-fx-tenant-realm/tenant-realm/my-image:v1.0.0
    should_authenticate_to_ghcr: true
    project_id: moz-fx-tenant-realm
    workload_identity_pool_project_number: ${{ vars.GCPV2_WORKLOAD_IDENTITY_POOL_PROJECT_NUMBER }}
```
